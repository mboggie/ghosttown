<!DOCTYPE html>
<html>
<head>
	<title>Covid Ghost Town</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--Twitter card-->
	<meta name="twitter:card" content="summary_large_image" />
	<!--OG tags-->
	<meta property="og:url" content="http://covidghosttown.com" />
	<meta property="og:title" content="Covid, USA" />
	<meta property="og:description" content="If COVID-19 had struck all in just one American city, which would have disappeared?" />
	<meta property="og:image" content="img/ghosttown-thumb.jpg" />

	<script type="text/javascript">

		function toCommas(value) {
			return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		}
		function loadCity() {
			let cities = [];
			let ghosttown = "";
			let rank = 0;
			let pop = 0;
			window.fetch('cities2.json')
			.then(response => response.json())
			.then(function(data){cities = data;
				//console.log(cities);
				let deaths = 0;
				window.fetch('https://api.covid19api.com/summary', {headers:{'Content-Type': 'application/json'}})
				.then(response => response.json())
				.then(function(json){
					c = json["Countries"];
					c.forEach(function(country){
						if(country.CountryCode == "US"){
							deaths = country.TotalDeaths;
						}
					});
					for (i=2; i < cities.length; i++){
						if ((cities[i].pop < deaths) && rank == 0){
							rank = cities[i].number;
							ghosttown = cities[i].city;
							pop = cities[i].pop;
							st = cities[i].state;
						};
					};
					//console.log(pop);
					text = "<p>Since the first recorded death in the U.S. on February 6 2020, " + toCommas(deaths) + " Americans have died from Covid-19. </p>"
					text += "<p>It&rsquo;s as though the residents of " + ghosttown + ", " + st + " (population " + toCommas(pop) + ") disappeared."
					//document.getElementById("number").innerHTML = toCommas(deaths);
					//document.getElementById("town").innerHTML = ghosttown;
					//document.getElementById("st").innerHTML = st;
					//document.getElementById("rank").innerHTML = rank;
					//document.getElementById("12345").innerHTML = toCommas(pop);
					document.getElementById("display").innerHTML = text;
				});
			});
		}
	</script>
	<link rel="stylesheet" type="text/css" href="reset.css">
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body onload="loadCity();">
		<h1 id="title">Covid Ghost Town</h1>
		<div id="wrapper">
			<div id="display">[gathering data]</div>
		</div>
		<div id="footer"><p><a href="http://www.twitter.com/mattboggie">@mattboggie</a></p>Covid data from <a href="https://api.covid19api.com">https://api.covid19api.com</a> | Population data from <a href="http://www.biggestuscities.com/top-1000">http://www.biggestuscities.com/top-1000</a></div>
</body>
</html>